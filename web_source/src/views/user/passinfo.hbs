<link rel="stylesheet" href="/css/passinfo.css">
<div class="container">
		<div class="passinfo-title">
				Password Detail
		</div>
		<div class="body">
				<div class="func-container">
						<div class="detail-container">
								<label for="detail">Mật khẩu chi tiết</label>
								<input type="text" name="" id="detail" value="{{passInfo.password}}" readonly>

								<label for="create-date">Ngày tạo</label>
								<input type="text" name="" id="create-date" value="{{passInfo.dateCreate}}" readonly>

								<label for="expiration-date">Ngày hết hạn</label>
								<input type="text" name="" id="expiration-date" value="{{passInfo.dateExpire}}" readonly>

								<label for="create-time">Thời gian tạo</label>
								<input type="text" name="" id="create-time" value="{{passInfo.timeCreate}}" readonly>

								<label for="expiration-time">Thời gian hết hạn</label>
								<input type="text" name="" id="expiration-time" value="{{passInfo.timeExpire}}" readonly> 

								<label for="login-apps">Website</label>
								<input type="text" name="" id="url" value="{{passInfo.url}}" readonly> 
						</div>
						<div class="btn-container">
								<button class="btn edit-btn" data-bs-toggle="modal" data-bs-target="#editModal">Edit</button>
								<button class="analyse-btn" data-bs-toggle="modal" data-bs-target="#analyseModal">Analyse</button>
						</div>
				</div>
				<div class="image">
						<img src="/img/detail_img.png" alt="Password Detail">
				</div>
		</div>
</div>


{{!-- Edit modal --}}
<div class="modal fade" id="editModal">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<!-- Modal body -->
			<div class="modal-body">  
			<form action="/passman/{{passInfo.url}}/passinfo" method="PATCH" id="EditForm">
				<div class="modalTitle" style="text-align: center;">Edit Password</div>
				<input type="password" class="form-control" name="oldPassword" placeholder="Old Password">
				<input type="password" class="form-control" name="newPassword" placeholder="New Password">
				<input type="password" class="form-control" name="confirmPassword" placeholder="Confirm Password">
				<button class="btn btn-primary" style="margin-inline:auto" data-bs-toggle="modal" onclick="validate()">Confirm</button> 
			</form>
			<script>
				function validate(){
					const EditForm = document.getElementById("EditForm");
					if (EditForm["newPassword"].value ==! EditForm["confirmPassword"].value){
						console.log("Fail");
						return;
					}
					console.log("Success");
					EditForm.submit();
				}
			</script>
			</div>
		</div>
	</div>
</div>

{{!-- Success modal
<div class="modal fade" id="successModal">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<!-- Modal body -->
			<div class="modal-body">
				<div class="modalTitle" style="text-align: center;">Success</div>
				<div class="notice">Password updated successfully!</div>
				<button class="btn btn-primary" style="margin-inline:auto" data-bs-dismiss="modal">OK</button>        
			</div>
		</div>
	</div>
</div>
 --}}


{{!-- Fail modal --}}
<div class="modal fade" id="failModal">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<!-- Modal body -->
			<div class="modal-body">
				<div class="modalTitle" style="text-align: center;">Fail</div>
				<div class="notice"> new password and confirm password must be the same! </div>
				<button class="btn btn-primary" style="margin-inline:auto" data-bs-dismiss="modal">OK</button>        
			</div>
		</div>
	</div>
</div>

{{!-- Verify Modal --}}
<div class="modal fade" id="verificationModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <!-- Modal body -->
      <div class="modal-body">
                <div class="modalTitle" style="text-align: center;">Verification Code</div>
                <div class="notice">We have sent the verification code to your email address</div>
                <div class="inputs d-flex flex-row justify-content-center mt-2 mb-2" id="otp">
                    <input class="m-2 text-center form-control rounded" type="text" id="first" maxlength="1" /> 
                    <input class="m-2 text-center form-control rounded" type="text" id="second" maxlength="1" /> 
                    <input class="m-2 text-center form-control rounded" type="text" id="third" maxlength="1" /> 
                    <input class="m-2 text-center form-control rounded" type="text" id="fourth" maxlength="1" /> 
                </div>
                <button class="btn btn-primary" style="margin-inline:auto" >OK</button>        
      </div>
    </div>
  </div>
</div>

{{!-- Analyse Modal --}}
<div class="modal fade" id="analyseModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal body -->
      <div class="modal-body">
                <div class="modalTitle" style="text-align: center;">Analyse Password</div>
                <div class="analyseRes"></div>
                <button class="btn btn-primary" style="margin-inline:auto" data-bs-target="#analyseModal" data-bs-toggle="modal" data-bs-dismiss="modal">OK</button>        
      </div>
    </div>
  </div>
</div>

{{!-- Scripty for OTP press vent --}}
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        function OTPInput() {
            const inputs = document.querySelectorAll('#otp > *[id]');
            for (let i = 0; i < inputs.length; i++) { 
                inputs[i].addEventListener('keydown', function(event) { 
                    if (event.key==="Backspace" ) { 
                        inputs[i].value='' ; 
                        if (i !==0) inputs[i - 1].focus(); 
                    } 
                    else { 
                        if (i===inputs.length - 1 && inputs[i].value !=='' ) { 
                            return true; 
                        } 
                        else if (event.keyCode> 47 && event.keyCode < 58) { 
                            inputs[i].value=event.key; 
                            if (i !==inputs.length - 1) inputs[i + 1].focus(); 
                            event.preventDefault(); 
                        } 
                        else if (event.keyCode> 64 && event.keyCode < 91) { 
                            inputs[i].value=String.fromCharCode(event.keyCode); 
                            if (i !==inputs.length - 1) inputs[i + 1].focus(); 
                            event.preventDefault();
                        }
                    } 
                });
            } 
        } 
        OTPInput();
    });
</script>
{{!-- Script for Display Information --}}
{{!-- <script>
// Get DOMs
const detailInp = document.querySelector("#detail");
const createDateInp = document.querySelector("#create-date");
const expiredDateInp = document.querySelector("#expiration-date");
const createTimeInp = document.querySelector("#create-time");
const expiredTimeInp = document.querySelector("#expiration-time");
const loginAppSelect = document.querySelector("#login-apps");

// Example Data for testing
passInfoList =[
  {id: "1", detail:"hallo", create_date:"20/11/2003", expired_date: "20/11/2003", create_time: "07:00:00", expired_time: "07:00:00", appList: ["Google", "Yahoo"]},
  {id: "2", detail:"deadline", create_date:"20/01/2003", expired_date: "20/01/2003", create_time: "07:00:00", expired_time: "07:00:00", appList: ["Google", "X"]},
  {id: "3", detail:"yayyy", create_date:"29/11/2003", expired_date: "29/11/2003", create_time: "07:00:00", expired_time: "07:00:00", appList: ["Google", "Facebook"]},
];

// Get password's ID
function getOpenPassID(){
  let decodedCookie = decodeURIComponent(document.cookie);
  let cookieList = decodedCookie.split(";");
  for(let i = 0 ; i < cookieList.length; i++){
    let nowCookie = cookieList[i].trim();
    let temp = nowCookie.split("=");
    if (temp[0] == "openPasswordID"){
      return temp[1];
    }
  }
  return -1;
}

// Get password information
function getPassInfo(){
  const displayId = getOpenPassID();
  let passInfo = null;
  passInfoList.forEach(function(pass){
    if (pass['id'] == displayId){
      passInfo = pass;
      return false;
    }
  });
  return passInfo;
}

function displayPassInfo(){
  const passInfo = getPassInfo();
  if (passInfo == null){
    alert("Display Incomplete!!!");
  }
  else{
     // alert("OK");
     // console.log(passInfo);
     detailInp.value = passInfo['detail'];
     createDateInp.value = passInfo['create_date'];
     expiredDateInp.value = passInfo['expired_date'];
     createTimeInp.value = passInfo['create_time'];
     expiredTimeInp.value = passInfo['expired_time'];
     passInfo['appList'].forEach(function(app){
        loginAppSelect.innerHTML += `<option>${app}</option>`;
     });
  }
}

displayPassInfo(); --}}


</script>